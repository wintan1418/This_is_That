<%# locals: (form:, field:, options:, selected: nil, blank: "Select an option...", label: nil) %>
<div data-controller="dropdown" class="relative">
  <% if label %>
    <label class="block text-sm font-medium text-gray-300 mb-2"><%= label %></label>
  <% end %>

  <%# Hidden native select for form submission %>
  <%= form.select field,
      options,
      { include_blank: blank, selected: selected },
      class: "hidden", data: { dropdown_target: "select" } %>

  <%# Custom button %>
  <button type="button"
          data-dropdown-target="button"
          data-action="click->dropdown#toggle"
          class="w-full px-4 py-3 bg-slate-800 border border-white/10 rounded-xl text-left flex items-center justify-between focus:outline-none focus:ring-2 focus:ring-teal-500 focus:border-transparent cursor-pointer hover:border-white/20 transition-colors">
    <span data-text class="<%= selected.present? ? 'text-white' : 'text-gray-500' %>">
      <%= if selected.present?
            opt = options.find { |o| (o.is_a?(Array) ? o.last : o).to_s == selected.to_s }
            opt.is_a?(Array) ? opt.first : opt
          else
            blank
          end %>
    </span>
    <svg data-dropdown-target="arrow" class="w-5 h-5 text-gray-400 transition-transform duration-200" fill="none" stroke="currentColor" viewBox="0 0 24 24">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
    </svg>
  </button>

  <%# Dropdown menu - always opens downward %>
  <div data-dropdown-target="menu"
       class="hidden absolute left-0 right-0 top-full mt-1 z-50 bg-slate-800 border border-white/10 rounded-xl shadow-xl shadow-black/30 max-h-60 overflow-y-auto">
    <%# Blank option %>
    <button type="button"
            data-action="click->dropdown#pick"
            data-value=""
            data-label="<%= blank %>"
            class="w-full px-4 py-3 text-left text-gray-500 hover:bg-white/5 transition-colors first:rounded-t-xl">
      <%= blank %>
    </button>
    <%# Category options %>
    <% options.each do |option| %>
      <% label_text = option.is_a?(Array) ? option.first : option %>
      <% value_text = option.is_a?(Array) ? option.last : option %>
      <button type="button"
              data-action="click->dropdown#pick"
              data-value="<%= value_text %>"
              data-label="<%= label_text %>"
              class="w-full px-4 py-3 text-left hover:bg-white/5 transition-colors last:rounded-b-xl <%= selected.to_s == value_text.to_s ? 'bg-teal-500/20 text-teal-400' : 'text-white' %>">
        <%= label_text %>
      </button>
    <% end %>
  </div>
</div>
